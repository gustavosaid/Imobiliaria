{% extends 'shared/base.html' %}
{% load static %}

{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* --- CONFIGURAÇÕES GERAIS --- */
    :root {
        --primary-color: #4f46e5;
        --success-color: #059669;
        --text-dark: #1e293b;
        --text-gray: #64748b;
        --bg-page: #f8fafc;
    }

    body { background-color: var(--bg-page); }

    .property-section {
        font-family: 'Inter', sans-serif;
        color: var(--text-dark);
        padding-top: 50px;
        padding-bottom: 50px;
    }

    /* --- O CARTÃO PRINCIPAL --- */
    .property-card {
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        overflow: hidden; 
        border: 1px solid #e2e8f0;
        /* AUMENTADO DE 900PX PARA 1100PX PARA DAR MAIS ESPAÇO */
        max-width: 1100px; 
        margin: 0 auto;
    }

    /* --- COLUNA DA FOTO & CARROSSEL --- */
    .image-column {
        background-color: #e2e8f0;
        /* Importante: No desktop, a altura é 100% da coluna pai */
        height: 100%; 
        min-height: 450px; 
        position: relative;
    }

    /* CSS DO CARROSSEL */
    .carousel-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
    }

    .carousel-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        width: 100%;
        height: 100%;
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .carousel-container::-webkit-scrollbar {
        display: none;
    }

    .carousel-slide {
        flex: 0 0 100%;
        width: 100%;
        height: 100%;
        scroll-snap-align: start;
    }

    .carousel-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Garante que a foto preencha tudo sem distorcer */
    }

    /* Setinhas de navegação */
    .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.4);
        color: white;
        border: none;
        cursor: pointer;
        padding: 0;
        z-index: 10;
        border-radius: 50%;
        width: 45px; /* Botões um pouco maiores */
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s, background 0.3s;
        font-size: 20px;
    }

    .carousel-btn:hover {
        background: rgba(0, 0, 0, 0.8);
    }

    .carousel-wrapper:hover .carousel-btn {
        opacity: 1;
    }

    .prev-btn { left: 20px; }
    .next-btn { right: 20px; }


    /* Badge (Categoria) */
    .badge-floating {
        position: absolute;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.95);
        color: var(--primary-color);
        padding: 6px 14px;
        border-radius: 30px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        z-index: 20;
        pointer-events: none;
        letter-spacing: 0.5px;
    }

    .no-photo-wrap {
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
        background: #f1f5f9;
    }

    /* --- COLUNA DE DETALHES --- */
    .details-column {
        padding: 40px; /* Mais espaçamento interno */
        display: flex;
        flex-direction: column;
        justify-content: center;
        height: 100%;
    }

    .property-title {
        font-size: 1.8rem; /* Fonte maior */
        font-weight: 800;
        color: var(--text-dark);
        margin-bottom: 10px;
        line-height: 1.2;
    }

    .property-price {
        font-size: 2rem; /* Preço bem visível */
        color: var(--success-color);
        font-weight: 700;
        margin-bottom: 25px;
    }

    .property-price span {
        font-size: 1rem;
        color: var(--text-gray);
        font-weight: 500;
    }

    .features-grid {
        display: flex;
        gap: 25px;
        margin-bottom: 25px;
        padding-bottom: 25px;
        border-bottom: 1px solid #e2e8f0;
    }

    .feature-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .feature-icon {
        color: var(--primary-color);
        background: #e0e7ff;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-size: 1rem;
    }

    .feature-text {
        font-size: 0.95rem;
        font-weight: 600;
        color: #334155;
    }

    .desc-title {
        font-size: 0.8rem;
        font-weight: 700;
        color: #94a3b8;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .property-description {
        color: var(--text-gray);
        line-height: 1.6;
        font-size: 1rem;
        margin-bottom: 35px;
    }

    /* --- BOTÕES --- */
    .action-buttons {
        display: grid;
        grid-template-columns: 130px 1fr; /* Largura fixa para o botão voltar, resto para o WhatsApp */
        gap: 15px;
    }

    .btn-back, .btn-rent {
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.2s;
        cursor: pointer;
    }

    .btn-back {
        background-color: white;
        border: 2px solid #e2e8f0;
        color: var(--text-gray);
    }
    .btn-back:hover { 
        border-color: var(--text-dark); 
        color: var(--text-dark); 
    }

    .btn-rent {
        background: var(--primary-color);
        color: white;
        border: none;
        gap: 10px;
        box-shadow: 0 4px 6px rgba(79, 70, 229, 0.2);
    }
    .btn-rent:hover { 
        background-color: #4338ca; 
        transform: translateY(-2px);
        box-shadow: 0 6px 8px rgba(79, 70, 229, 0.3);
    }

    /* Responsividade */
    @media (max-width: 991px) {
        /* No Mobile/Tablet, a imagem fica em cima e precisa de altura fixa */
        .image-column { 
            height: 350px !important; 
            min-height: 350px !important;
        }
        
        .details-column { 
            padding: 25px; 
        }
        
        .property-title { font-size: 1.5rem; }
        .property-price { font-size: 1.6rem; }
        
        .action-buttons {
            grid-template-columns: 1fr; /* Botões empilhados no mobile */
        }
    }
</style>

<div class="container property-section">
    <div class="property-card">
        <div class="row g-0"> 
            
            <div class="col-lg-6">
                <div class="image-column">
                    
                    <div class="badge-floating">
                        {{ imovel.categoria }}
                    </div>

                    <div class="carousel-wrapper" id="carousel-detalhe">
                        <div class="carousel-container">
                            
                            <div class="carousel-slide">
                                {% if imovel.foto %}
                                    <img src="{{ imovel.foto.url }}" alt="{{ imovel.nome }}">
                                {% else %}
                                    <div class="no-photo-wrap">
                                        <i class="fa-regular fa-image fa-3x mb-3"></i>
                                        <span>Sem foto disponível</span>
                                    </div>
                                {% endif %}
                            </div>

                            {% for img_extra in imovel.imagens.all %}
                            <div class="carousel-slide">
                                <img src="{{ img_extra.imagem.url }}" alt="Foto extra">
                            </div>
                            {% endfor %}

                        </div>

                        {% if imovel.imagens.all %}
                            <button class="carousel-btn prev-btn" onclick="moverCarrossel('detalhe', -1)">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <button class="carousel-btn next-btn" onclick="moverCarrossel('detalhe', 1)">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="details-column">
                    
                    <h1 class="property-title">{{ imovel.nome }}</h1>

                    <div class="property-price">
                        R$ {{ imovel.valor }} <span>/ mês</span>
                    </div>

                    <div class="features-grid">
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fa-solid fa-ruler-combined"></i></div>
                            <span class="feature-text">{{ imovel.tamanho|default:"--" }} m²</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon"><i class="fa-solid fa-bed"></i></div>
                            <span class="feature-text">{{ imovel.numero_quarto }} Quartos</span>
                        </div>
                    </div>

                    <div class="desc-title">Sobre o imóvel</div>
                    <p class="property-description">
                        {{ imovel.descricao }}
                    </p>

                    <div class="action-buttons">
                        <a href="{% url 'home' %}" class="btn-back">
                            <i class="fa-solid fa-arrow-left" style="margin-right: 5px;"></i> Voltar
                        </a>
                        <a href="https://wa.me/5534996336172?text=Olá, tenho interesse no imóvel: {{ imovel.endereco }}, {{ imovel.bairro }} - {{ imovel.tamanho }}m²" target="_blank" class="btn-rent">
                            <i class="fa-brands fa-whatsapp" style="font-size: 1.2rem;"></i> 
                            Falar com o Corretor
                        </a>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function moverCarrossel(id, direcao) {
        const wrapper = document.getElementById('carousel-' + id);
        const container = wrapper.querySelector('.carousel-container');
        const scrollAmount = container.clientWidth * direcao;
        
        container.scrollBy({
            left: scrollAmount,
            behavior: 'smooth'
        });
    }
</script>

{% endblock %}