{% load static %}

<style>
    /* --- ESTILOS GERAIS DO CARD --- */
    .galeria-container {
        padding: 40px 0;
        background-color: #f9fafb;
    }

    .cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 30px;
        padding: 0 20px;
    }

    .imovel-card {
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s, box-shadow 0.2s;
        border: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .imovel-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
    }

    .card-img-top {
        height: 200px;
        width: 100%;
        position: relative;
    }

    .card-body {
        padding: 20px;
    }

    .card-header-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .tag-tipo {
        background-color: #e0e7ff;
        color: #4338ca;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
    }

    .preco-texto {
        color: #059669;
        font-weight: 800;
        font-size: 1.1rem;
    }

    .card-titulo {
        font-size: 1.25rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 5px;
        text-transform: capitalize;
    }

    .card-meta {
        font-size: 0.85rem;
        color: #6b7280;
        margin-bottom: 5px;
    }

    .card-endereco {
        font-size: 0.9rem;
        color: #4b5563;
        margin-bottom: 10px;
    }

    .card-descricao {
        font-size: 0.9rem;
        color: #6b7280;
        display: -webkit-box;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        margin-bottom: 15px;
    }

    .card-footer {
        padding: 15px 20px;
        background-color: #fff;
        border-top: 1px solid #f3f4f6;
    }

    .btn-detalhes {
        display: block;
        width: 100%;
        background-color: #5452f6;
        color: white;
        text-align: center;
        padding: 10px 0;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: background 0.3s;
        margin-bottom: 5px;
    }

    .btn-detalhes:hover {
        background-color: #4338ca;
        color: white;
        text-decoration: none;
    }

    /* --- CSS DO CARROSSEL (SLIDER) --- */
    .carousel-wrapper {
        position: relative;
        width: 100%;
        height: 100%; /* Ocupa os 200px do pai */
    }

    .carousel-container {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        width: 100%;
        height: 100%;
        /* Esconder barra de rolagem */
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .carousel-container::-webkit-scrollbar {
        display: none;
    }

    .carousel-slide {
        flex: 0 0 100%;
        width: 100%;
        height: 100%;
        scroll-snap-align: start;
    }

    .carousel-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .no-photo {
        background-color: #5452f6;
        height: 100%;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        font-weight: bold;
    }

    /* Setinhas de navega√ß√£o */
    .carousel-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(0, 0, 0, 0.6);
        color: white;
        border: none;
        cursor: pointer;
        padding: 0;
        z-index: 10;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
        font-size: 18px;
    }

    .carousel-wrapper:hover .carousel-btn {
        opacity: 1;
    }

    .prev-btn { left: 10px; }
    .next-btn { right: 10px; }
</style>

<section class="galeria-container">
    {% include 'partials/_buscar.html' %}
    
    <div class="container">
        <h2 style="text-align: center; margin-bottom: 40px; color: #333; font-weight: bold;">Im√≥veis Dispon√≠veis</h2>

        {% if cards %}
        <div class="cards-grid">
            {% for imovel in cards %}

            <div class="imovel-card">

                <div class="card-img-top">
                    <div class="carousel-wrapper" id="carousel-{{ imovel.id }}">
                        
                        <div class="carousel-container">
                            <div class="carousel-slide">
                                <a href="{% url 'imagem' imovel.id %}">
                                    {% if imovel.foto %}
                                        <img src="{{ imovel.foto.url }}" alt="{{ imovel.nome }}">
                                    {% else %}
                                        <div class="no-photo">Sem Foto</div>
                                    {% endif %}
                                </a>
                            </div>

                            {% for img_extra in imovel.imagens.all %}
                            <div class="carousel-slide">
                                <a href="{% url 'imagem' imovel.id %}">
                                    <img src="{{ img_extra.imagem.url }}" alt="Foto Extra">
                                </a>
                            </div>
                            {% endfor %}
                        </div>

                        {% if imovel.imagens.all %}
                            <button class="carousel-btn prev-btn" onclick="moverCarrossel('{{ imovel.id }}', -1)">&#10094;</button>
                            <button class="carousel-btn next-btn" onclick="moverCarrossel('{{ imovel.id }}', 1)">&#10095;</button>
                        {% endif %}
                        
                    </div>
                </div>

                <div class="card-body">
                    <div class="card-header-info">
                        <span class="tag-tipo">{{ imovel.categoria }}</span>
                        <span class="preco-texto">R$ {{ imovel.valor }}</span>
                    </div>

                    <h3 class="card-titulo">{{ imovel.nome }}</h3>

                    <div class="card-meta">
                        {{ imovel.tamanho|default:"--" }}m¬≤ | {{ imovel.numero_quarto|default:"--" }} Quartos
                    </div>

                    <div class="card-endereco">
                        {{ imovel.endereco|default:"Endere√ßo n√£o informado" }}
                    </div>

                    <p class="card-descricao">
                        {{ imovel.descricao }}
                    </p>
                </div>

                <div class="card-footer">
                    <a href="{% url 'imagem' imovel.id %}" class="btn-detalhes">
                        Ver Detalhes
                    </a>

                    {% if user.is_superuser %}
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <a href="{% url 'editar_imovel' imovel.id %}" class="btn-detalhes" style="background-color: #007a4d; flex: 1;">
                            ‚úèÔ∏è Editar
                        </a>
                        <a href="{% url 'deletar_imovel' imovel.id %}" class="btn-detalhes" style="background-color: #dc2626; flex: 1;"
                           onclick="return confirm('Tem certeza que deseja excluir este im√≥vel?');">
                            üóëÔ∏è Excluir
                        </a>
                    </div>
                    {% endif %}
                </div>

            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 50px;">
            <p>Nenhum im√≥vel cadastrado no momento.</p>
        </div>
        {% endif %}
    </div>
</section>

<script>
    function moverCarrossel(idImovel, direcao) {
        // Encontra o container espec√≠fico desse im√≥vel
        const wrapper = document.getElementById('carousel-' + idImovel);
        const container = wrapper.querySelector('.carousel-container');
        
        // Calcula a largura do slide para saber quanto rolar
        const scrollAmount = container.clientWidth * direcao;
        
        container.scrollBy({
            left: scrollAmount,
            behavior: 'smooth'
        });
    }
</script>